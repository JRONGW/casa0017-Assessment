<!DOCTYPE html>
<html>
  <head>
    <title>Country Line Graph</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/css/country.css" />
    <link rel="stylesheet" href="/css/home.css" />

    <script src="../client/js/home.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
  </head>
  <body>
      <header class="pill-bar header">
    <div class="pill-inner">
      <div class="left"></div>

      <div class="center">
       <a href="index.html"><h1 class="site-title" style="color: black;">Equilibrium</h1></a> 
        <nav class="site-nav">
          <a href="/about.html">About</a>
          <a href="timeline.html">Timeline</a>
          <a href="country.html?country=Brazil">Brazil</a>
          <a href="country.html?country=Poland">Poland</a>
          <a href="country.html?country=South%20Korea">South Korea</a>

        </nav>
      </div>

     
  </header>
  
    <h2 id="countryName"></h2>

    <!-- Country description area (HTML loaded dynamically here) -->
    <div id="countryContent" style="max-width:800px; line-height:1.6;"></div>

    <div style="position:relative; width:800px; height:400px;">
      <canvas id="canvasChart" width="800" height="400"
        style="position:absolute; top:0; left:0;"></canvas>
    </div>

    <div style="margin-top:10px;">
      <button onclick="showAllData()">Show All Data</button>
      <button onclick="erase()">Redo Line</button>
    </div>

    <script type="text/javascript" src="js/utils/lineGraph.js"></script>

    <script>
      const params = new URLSearchParams(window.location.search);
      const countryName = params.get("country");

      document.getElementById("countryName").textContent = countryName;

      // Mapping to ISO codes
      const ISO3_BY_NAME = {
        "Brazil": "BRA",
        "Poland": "POL",
        "South Korea": "KOR"
      };

      // Dynamically load the correct HTML snippet
      async function loadCountryHTML(countryName) {
        const fileName = countryName.toLowerCase().replace(/\s+/g, "") + ".html";
        const url = `content/${fileName}`;

        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error("Country content not found: " + url);

          const html = await res.text();
          document.getElementById("countryContent").innerHTML = html;
        } catch (err) {
          console.warn(err);
          document.getElementById("countryContent").innerHTML =
            `<p>No description available for ${countryName}.</p>`;
        }
      }

      const countryCode = ISO3_BY_NAME[countryName];

      window.onload = async function() {
        await loadCountryHTML(countryName);   // ← Load written content
        init();                              // ← Set up chart canvas etc.
        await fetchCountryGDP(countryCode);  // ← Fetch and draw data
      };
    </script>
  </body>
</html>
